# ECG Evaluation Tool
This evaluation tool is designed as a supplemental material to the paper titled 
"_PMcardio ECG Image Database (PM-ECG-ID): A Diverse ECG Database for Evaluating Digitization Solutions_" by Viera Kresnakova MSc,
Robert Herman MD, Andrej Iring MSc, Vladimir Boza MSc, PhD, Michal Hojcka MSc, PhD, Simon Rovder MInf,
Timotej Palus MSc, Anthony Demolder MD, PhD, Martin Herman, Felix Bauer BSc, Viktor Jurasek, Robert Hatala MD, PhD, 
Jozef Bartunek MD, PhD and Boris Vavrik MSc.


The tool evaluates the performance of digitized ECG data by comparing it to a 
gold standard ECG dataset. It calculates the Digitized signal similarity metric for each 
ECG and provides summary statistics to support the findings presented in the paper.

## Objective
The objective of this evaluation tool is to provide a quantitative comparison between the 
digitized ECGs and the gold standard ECG dataset. This comparison allows the readers to 
understand the effectiveness of the digitization methods discussed in the paper and to potentially reproduce the results
or apply the methods to their own datasets.

## Methodology
The evaluation tool calculates the Digitized signal similarity metric for each ECG by comparing the digitized ECG data to
the gold standard dataset. The comparison is performed using the `compare_ecgs` function, which calculates error scores 
between the two signals. The normalized score is then calculated as `max(0, 1 - digi_res / flat_res)`, where `digi_res` is 
the error for the digitized ECG, and `flat_res` is the error for a flat (zero-valued) ECG. 
The higher value of the metric indicates better performance in terms of digitization accuracy.

## Results Interpretation
The summary statistics provided by the evaluation tool include the average Digitized signal similarity metric for 
each dataset and the total average score. These results can be used to compare different digitization methods, 
assess the impact of input quality, or support the conclusions drawn in the paper.

_Note_: This evaluation tool is intended to be used as a supplement to the paper and should be used in conjunction 
with the paper's main content to fully understand the context and implications of the results generated by the tool.

## Expected folder structure

### Provided Data Folder:

```
base_dir/
  data/
    leads.npz
    rhythms.npz
  visual_data/
    augmentation_JPEG_compression_11_percent/
      img_1_page_0.jpeg
      ...
    ...
  metadata.csv
```

The data folder contains original EGGs.
The format is as follows. In `leads.npz`, there is a dictionary keyed by ECG ID (from metadata), and each value is a 12 lead ECG sampled with 500 Hz frequency (first dimension is time, second are leads).
If there are rhythm leads present, they can be found in `rhythms.npz` under the corresponding ECG ID.

### Digitized Data Folder:

The folder structure should be the same as the visual data folder, but with JSON files for each image. 
For multipage ECGs, provide just one file.

```
digi_ecg_dir/
  augmentation_JPEG_compression_11_percent/
    img_1.json
    img_2.json
  ...
```

If you cannot digitize an ECG, you may omit the corresponding file (you will get a score of 0 for that ECG).

### Expected response format:

The expected response should be a JSON formatted as follows:

```
{
  "I": {"ecg": [<list of values in mV>], "fs": <sampling frequency>},
  "II": {...},
  ...
  "V6": {...}
}
```

Rhythm leads (if present) are marked as "rhythm1", "rhythm2", "rhythm3".

Example of such output is in `example_digitization` folder.

## Running evaluation
Calculate the Digitized signal similarity for each ECG:

`python calc.py <dataset_folder> <digitized_folder> <output_csv>`

Summarize the scores and print the results:

`python summarize.py <output_csv>`

This will generate a summary of the Digitized signal similarity metric by dataset and the total average score.

## ECG Visualization

Contained within `visualization.py`, the `visualize` function provides a seamless method for visualizing ECG data from a `numpy` 
array. It creates a grid structure resembling the standard ECG format and plots the signals for each lead.